{% include '_header.twig' %}
{% set filterroot = app.request.getSchemeAndHttpHost() ~  "/apps" %}

{% setcontent allapp = 'apps' %}	

{# set order #}
{% set order = contenttype['sort'] %}
{% if app.request.get('order') %}
    {% set order = app.request.get('order') %}
{% endif %}

{# set page number #}
{% set page = app.request.get('page', 1) %}

{# set amount #}
{% if contenttype['listing_records'] is defined %}
    {% set amount = contenttype['listing_records'] %}
{% else %}
    {% set amount = app.config.get('general/listing_records') %}
{% endif %}

{% set amount = 6 %}

{% if records|length %}
    {# show/hide sortby item and pager #}
    {% set showsortby = false %}

    {# default list views #}
    {% if record is not defined %}

        {# tags #}
        {% if taxonomy is defined %}
            {% set showsortby = false %}
            {% set contenttype = taxonomy %}

        {% else %}
            {% set contenttype = getContenttype(records|first.contenttype.name) %}
            {% set showsortby = true %}
            {% set contenttypePager = 'apps' %}
        {% endif %}

    {# structure content #}
    {% elseif contenttype['name'] is defined %}
        {% if (contenttype['slug'] in app.config.get('general/sort_options/disabled')|keys ) %}
            {% set contenttypePager = 'apps' %}
            {% set showsortby = true %}
        {% endif %}
    {% endif %}

    
    {% set contentfilters = {} %}
    {% set category = app.request.get('category')  %}
    {% if category != null %}
        {% set contentfilters = contentfilters|merge({ appcategories: category }) %}
    {% endif %}
    {% set theme = app.request.get('theme')  %}
    {% if theme != null %}
        {% set contentfilters = contentfilters|merge({ appthemes: theme }) %}
    {% endif %}
    {% set tag = app.request.get('tag')  %}
    {% if tag != null %}
        {% set contentfilters = contentfilters|merge({ apptags: tag }) %}
    {% endif %}
    {% setcontent records = 'apps' where contentfilters allowpaging limit 10 %}

    
<!-- Start content -->
<main role="main">
<section class="block-content-header">
	<div class="grid_wrapper">
		<div class="grid">
			<div class="contents">
				<div class="title">
				     <h1 class="title">Apps showcase</h1>
				     <p class="subhead">Explore our showcase of applications using the Europeana APIs and re-usable content. Discover tools to get you started, or browse our directory of open source software.</p>
                     <p class="subhead">Is your app missing here? If so <a href="http://labs.europeana.eu/support/contact/">get in touch</a></p>
				</div>
			</div>
		</div>
	</div>
</section>
<section class="grid_wrapper">

	<div class="grid">
		<div class="sidebar">
			<div class="subnav">
				<h4 class="label epsilon"> Categories:</h4>
				<ul class="tags tags-large">
                    {% for category in app.config.get('taxonomy/appthemes/options') -%}
                        <li><a class="tag" href="{{ root }}?theme={{ category|slug }}">{{ category }}</a></li>
                    {% endfor %}
				</ul>		
                <h4 class="label epsilon"> Filter by:</h4>
				<ul class="tags tags-large">
                    {% for category in app.config.get('taxonomy/appcategories/options') -%}
                        {% set themefilter = "" %}
                        {% if theme != null %}
                            {% set themefilter = "&theme=" ~ theme %}
                        {% endif %}
                        <li><a class="tag" href="{{ root }}?category={{ category|slug ~ themefilter }}">{{ category }}</a></li>
                    {% endfor %}
				</ul>		
			</div>	
		</div><!--
--><div class="main-content">

	<ul class=""><!--
            {% for listItem in records %}
                {% include 'items/_item-list.twig' with { record: listItem } %}
            {% endfor %}
           --></ul>
		{{ pager('apps') }}
	</div>
</div>

</section>

</main>
<!-- End Content -->



{% endif %}

{% include '_footer.twig' %}

